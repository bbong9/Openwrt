# æç®€è½»é‡ç‰ˆï¼ˆä¿ç•™å¹¿å‘Šè§„åˆ™ï¼‰
# ç›®æ ‡ï¼šè¶³å¤Ÿå¥½ç”¨ + ä½è´Ÿè½½ã€‚ä»…ä¿ç•™æ ¸å¿ƒåˆ†æµä¸å¿…è¦è§„åˆ™ã€‚

# ========== è®¢é˜…ä¸é™æ€èŠ‚ç‚¹ ==========
proxy-providers:
  çš®:
    url: ""          # â† å¡«ä½ çš„è®¢é˜…
    type: http
    interval: 86400
    health-check: { enable: true, url: https://www.gstatic.com/generate_204, interval: 300 }
    proxy: ç›´è¿
  ç²¾çµ:
    url: ""          # â† å¡«ä½ çš„è®¢é˜…
    type: http
    interval: 86400
    health-check: { enable: true, url: https://www.gstatic.com/generate_204, interval: 300 }
    proxy: ç›´è¿

proxies:
  - { name: ç›´è¿, type: direct }

# ========== å…¥ç«™ç«¯å£ ==========
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7894
allow-lan: true
bind-address: "*"
ipv6: false
unified-delay: true
tcp-concurrent: true
log-level: warning
find-process-mode: "off"
global-client-fingerprint: chrome
keep-alive-idle: 600
keep-alive-interval: 15
disable-keep-alive: false

# ========== æ§åˆ¶é¢æ¿ï¼ˆé»˜è®¤ä»…æœ¬æœºï¼‰ ==========
external-controller: 127.0.0.1:9090
secret: "è¯·æ”¹ä¸ºå¼ºå¯†ç "
external-ui: "/etc/nikki/run"
external-ui-name: zashboard
external-ui-url: "https://github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip"

# ========== å—…æ¢ï¼ˆä¿®å¤åªæ˜¾ç¤º IP æ— æ³•åŒ¹é…è§„åˆ™ï¼‰ ==========
sniffer:
  enable: true
  parse-pure-ip: true
  force-dns-mapping: true
  sniff:
    HTTP: { ports: [80, 8080-8880], override-destination: true }
    TLS:  { ports: [443, 8443],     override-destination: true }
    QUIC: { ports: [443, 8443],     override-destination: true }
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "+.baidu.com"

# ========== TUN ==========
tun:
  enable: true
  stack: mixed
  dns-hijack:
    - 198.18.0.1:53
    - tcp://198.18.0.1:53
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

# ========== DNSï¼ˆç²¾ç®€ç¨³å¦¥ï¼‰ ==========
dns:
  enable: true
  listen: 127.0.0.1:1053
  ipv6: false
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.0/16
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - "rule-set:private_domain"
    - "rule-set:cn_domain"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "time.*.com"
    - "+.market.xiaomi.com"
  default-nameserver:
    - 223.5.5.5
  proxy-server-nameserver:
    - https://223.5.5.5/dns-query
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
  nameserver:
    - 211.137.130.3
    - 211.137.130.19
  nameserver-policy:
    "geosite:geolocation-!cn":
      - https://1.1.1.1/dns-query
      - https://8.8.8.8/dns-query
    "geosite:cn":
      - 211.137.130.3
      - 211.137.130.19

# ========== é¢æ¿ç¼“å­˜ ==========
profile:
  store-selected: true
  store-fake-ip: true

# ========== å‡ºç«™ç­–ç•¥ç»„ ==========
proxy-groups:
  # å¸¸ç”¨é€‰æ‹©
  - { name: ğŸš€ é»˜è®¤ä»£ç†, type: select, proxies: [ğŸ”¯ æ—¥æœ¬æ•…è½¬, ğŸ”¯ ç‹®åŸæ•…è½¬, ğŸ”¯ ç¾å›½æ•…è½¬, ğŸ”¯ é¦™æ¸¯æ•…è½¬, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿] }
  - { name: ğŸ¤– ChatGPT,  type: select, proxies: [ğŸ”¯ æ—¥æœ¬æ•…è½¬, ğŸ”¯ ç‹®åŸæ•…è½¬, ğŸ”¯ ç¾å›½æ•…è½¬, ğŸ”¯ é¦™æ¸¯æ•…è½¬, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿] }
  - { name: ğŸ€ Google,   type: select, proxies: [ğŸ”¯ æ—¥æœ¬æ•…è½¬, ğŸ”¯ ç‹®åŸæ•…è½¬, ğŸ”¯ ç¾å›½æ•…è½¬, ğŸ”¯ é¦™æ¸¯æ•…è½¬, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿] }
  - { name: ğŸ“¹ YouTube,  type: select, proxies: [ğŸ”¯ ç‹®åŸæ•…è½¬, ğŸ”¯ æ—¥æœ¬æ•…è½¬, ğŸ”¯ ç¾å›½æ•…è½¬, ğŸ”¯ é¦™æ¸¯æ•…è½¬, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿] }
  - { name: ğŸ‘¨ğŸ¿â€ğŸ’» GitHub, type: select, proxies: [ğŸ”¯ æ—¥æœ¬æ•…è½¬, ğŸ”¯ ç‹®åŸæ•…è½¬, ğŸ”¯ ç¾å›½æ•…è½¬, ğŸ”¯ é¦™æ¸¯æ•…è½¬, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿] }
  - { name: ğŸ“² Telegram, type: select, proxies: [ğŸ”¯ ç‹®åŸæ•…è½¬, ğŸ”¯ æ—¥æœ¬æ•…è½¬, ğŸ”¯ ç¾å›½æ•…è½¬, ğŸ”¯ é¦™æ¸¯æ•…è½¬, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿] }
  - { name: ğŸ¯ ç›´è¿,     type: select, proxies: [ç›´è¿, ğŸš€ é»˜è®¤ä»£ç†] }
  - { name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸ”¯ æ—¥æœ¬æ•…è½¬, ğŸ”¯ ç‹®åŸæ•…è½¬, ğŸ”¯ ç¾å›½æ•…è½¬, ğŸ”¯ é¦™æ¸¯æ•…è½¬, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿] }

  # åœ°åŒºèšåˆï¼ˆä»… fallbackï¼Œä½æŠ–åŠ¨ï¼‰
  - { name: ğŸ”¯ æ—¥æœ¬æ•…è½¬, type: fallback, include-all: true, tolerance: 12, interval: 300, filter: "(?i)(æ—¥|jp|japan|ğŸ‡¯ğŸ‡µ)" }
  - { name: ğŸ”¯ ç‹®åŸæ•…è½¬, type: fallback, include-all: true, tolerance: 12, interval: 300, filter: "(?i)(æ–°|sg|singapore|ğŸ‡¸ğŸ‡¬)" }
  - { name: ğŸ”¯ ç¾å›½æ•…è½¬, type: fallback, include-all: true, tolerance: 12, interval: 300, filter: "(?i)(ç¾|us|united|states|usa|america|ğŸ‡ºğŸ‡¸)" }
  - { name: ğŸ”¯ é¦™æ¸¯æ•…è½¬, type: fallback, include-all: true, tolerance: 12, interval: 300, filter: "(?i)(æ¸¯|hk|hong|ğŸ‡­ğŸ‡°)" }

  # å•ä¸€è‡ªåŠ¨æµ‹é€Ÿï¼ˆå…¨é‡èŠ‚ç‚¹ï¼‰ï¼Œå‡å°‘å¥åº·æ£€æŸ¥è´Ÿæ‹…
  - { name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©, type: url-test, include-all: true, interval: 300, tolerance: 20, filter: "^((?!(ç›´è¿)).)*$" }
  - { name: ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, type: select, include-all: true }
  - { name: ğŸ†  ADBlock,  type: select, proxies: [REJECT, ğŸ¯ ç›´è¿] }

# ========== è§„åˆ™ ==========
rules:
  # ä¸ªæ€§åŒ–ç›´è¿ / ç™½åå•ï¼ˆæŒ‰éœ€ä¿ç•™/å¢å‡ï¼‰
  - IP-CIDR,144.34.230.131/32,ğŸ¯ ç›´è¿
  - IP-CIDR,47.76.58.115/32,ğŸ¯ ç›´è¿
  - IP-CIDR,46.232.107.30/32,ğŸ¯ ç›´è¿
  - IP-CIDR,23.146.72.187/32,ğŸ¯ ç›´è¿
  - DOMAIN-SUFFIX,bbong9.cn,ğŸ¯ ç›´è¿
  - DOMAIN,younoyes.com,ğŸ¯ ç›´è¿

  # é€šç”¨ç›´è¿ï¼ˆæ—¶é—´åŒæ­¥ / é€šè¯ï¼‰
  - DST-PORT,123,ğŸ¯ ç›´è¿
  - DOMAIN,stun.l.google.com,ğŸ¯ ç›´è¿
  - DOMAIN-KEYWORD,stun,ğŸ¯ ç›´è¿

  # å¸¸ç”¨ä¸šåŠ¡ï¼ˆç²¾ç®€ä¿ç•™ï¼‰
  - RULE-SET,ai,ğŸ¤– ChatGPT
  - RULE-SET,google_domain,ğŸ€ Google
  - RULE-SET,youtube_domain,ğŸ“¹ YouTube
  - RULE-SET,github_domain,ğŸ‘¨ğŸ¿â€ğŸ’» GitHub
  - RULE-SET,telegram_domain,ğŸ“² Telegram

  # å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,Advertising_domain,ğŸ†  ADBlock

  # åŸºç¡€åœ°ç†è·¯ç”±
  - RULE-SET,private_domain,ç›´è¿
  - RULE-SET,gfw_domain,ğŸš€ é»˜è®¤ä»£ç†
  - RULE-SET,geolocation-!cn,ğŸš€ é»˜è®¤ä»£ç†
  - RULE-SET,cn_domain,ğŸ¯ ç›´è¿

  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# ========== è§„åˆ™é›†é”šç‚¹ ==========
rule-anchor:
  ip:      &ip      { type: http, interval: 86400, behavior: ipcidr,   format: mrs }
  domain:  &domain  { type: http, interval: 86400, behavior: domain,   format: mrs }
  class:   &class   { type: http, interval: 86400, behavior: classical, format: text }
  class2:  &class2  { type: http, interval: 86400, behavior: classical, format: yaml }
  domain2: &domain2 { type: http, interval: 86400, behavior: domain,   format: yaml }

# ========== è§„åˆ™é›†æ¥æºï¼ˆç»Ÿä¸€ gh-proxyï¼‰ ==========
rule-providers:
  private_domain:    { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/private.mrs",          path: ./ruleset/private.mrs }
  ai:                { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-ai-!cn.mrs",  path: ./ruleset/chatgpt.mrs }
  google_domain:     { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/google.mrs",           path: ./ruleset/google.mrs }
  youtube_domain:    { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/youtube.mrs",          path: ./ruleset/youtube.mrs }
  github_domain:     { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/github.mrs",           path: ./ruleset/github.mrs }
  telegram_domain:   { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/telegram.mrs",         path: ./ruleset/telegram.mrs }
  gfw_domain:        { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/gfw.mrs",              path: ./ruleset/gfw.mrs }
  geolocation-!cn:   { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/geolocation-!cn.mrs",  path: ./ruleset/geolocation-not-cn.mrs }
  cn_domain:         { <<: *domain,  url: "https://gh-proxy.com/github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/cn.mrs",               path: ./ruleset/cn.mrs }
  Advertising_domain:{ <<: *domain2, url: "https://gh-proxy.com/raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising_Domain.yaml", path: ./ruleset/Adblock.yaml }
